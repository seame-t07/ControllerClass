name: 'Cross Compile Controller'

description: 'Compiles the Controller project using Docker container for ARM architecture and deploys to Raspberry Pi.'

inputs:
  build_path:
    description: 'Path to the project to build (e.g., /workspace)'
    required: true
    default: '/workspace'
  output_path:
    description: 'Path to copy the compiled executable'
    required: true
    default: '/workspace/build/ControllerExec'
  deploy_ip:
    description: 'IP address of the Raspberry Pi to deploy the executable'
    required: true
    default: '192.168.1.186'

runs:
  using: 'docker'
  image: 'hmacielp/crosscompile-gpio:latest'
  args:
    - bash
    - -c
    - |
        echo "Starting cross-compilation..."
        cd $INPUT_BUILD_PATH
        mkdir -p build
        cd build
        cmake ..
        make
        echo "Compilation complete."

        echo "Deploying to Raspberry Pi..."
        scp $INPUT_OUTPUT_PATH team07@$INPUT_DEPLOY_IP:/Controller
        echo "Deployment complete."
